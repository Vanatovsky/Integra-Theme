import"./style.css";import*as THREE from"three";import*as dat from"dat.gui";import{GLTFLoader}from"three/examples/jsm/loaders/GLTFLoader";import waterVertexShader from"./shaders/water/vertex.glsl";import waterFragmentShader from"./shaders/water/fragment.glsl";import wallVertexShader from"./shaders/back-wall/vertex.glsl";import wallFragmentShader from"./shaders/back-wall/fragment.glsl";import{FontLoader}from"three/examples/jsm/loaders/FontLoader";import{TextGeometry}from"three/examples/jsm/geometries/TextGeometry";import{TWEEN}from"three/examples/jsm/libs/tween.module.min";const gltfLoader=new GLTFLoader,textureLoader=new THREE.TextureLoader,whaleNormalTexture=textureLoader.load("/textures/whale/NORMAL_MAP.jpg"),whaleColorTexture=textureLoader.load("/textures/whale/Defuse_2K.png");let mouseX=0,mouseY=0,mouse_ray=new THREE.Vector2,mixer,whale_mesh,whale_mesh_level3,whale_group_level3,animations,whale_model,level_2_text_group,level_1_group,level_2_group,level_3_group,particles,particles_2,active_text_group,pointCursorGroup,pointCursorGroup_level3,tween_cursor_animation=new TWEEN.Tween,cursorAnimateTo,cameraAnimation,eventClickCanvas;cameraAnimation=new TWEEN.Tween;let prevTime=Date.now(),text_objs_for_raycaster=[];level_1_group=new THREE.Group,level_2_group=new THREE.Group,level_3_group=new THREE.Group;const canvas=document.querySelector("canvas.webgl"),scene=new THREE.Scene,raycaster=new THREE.Raycaster;document.addEventListener("mousemove",onDocumentMouseMove),document.addEventListener("scroll",onDocumentScroll);const gui=new dat.GUI,settings={depthColor:"#00ffff",surfaceColor:"#235a7a",water_rotation_x:.5,camera_look_at_center:!0,camera_animation:new TWEEN.Tween,camera_position_x:0,camera_position_y:0,camera_position_z:5,water_position_x:0,water_position_y:1.7,water_position_z:1.3,water_level_1_position_x:0,water_level_1_position_y:-1,water_level_1_position_z:1.3,text_position_x:-3.25,text_position_y:0,text_position_z:-.5,text_2_position_x:-1.75,text_2_position_y:-.68,text_2_position_z:.68,text_3_position_x:.69,text_3_position_y:.85,text_3_position_z:1.26,text_4_position_x:.38,text_4_position_y:-.57,text_4_position_z:2.44,text_5_position_x:-.88,text_5_position_y:.62,text_5_position_z:1.12,mode_high_rotation:!1,color_material_whale_level_3:7339946,active_level:2,level_animation_start:!1},cameraGroup=gui.addFolder("Camera");cameraGroup.add(settings,"camera_position_x").min(-10).max(10).step(.1).name("Position Camera X").onChange(()=>{camera.position.x=settings.camera_position_x}),cameraGroup.add(settings,"camera_position_y").min(-10).max(10).step(.1).name("Position Camera Y").onChange(()=>{camera.position.y=settings.camera_position_y}),cameraGroup.add(settings,"camera_position_z").min(-10).max(10).step(.1).name("Position Camera Z").onChange(()=>{camera.position.z=settings.camera_position_z});const whale_material=new THREE.MeshStandardMaterial({metalness:0,roughness:1,normalMap:whaleNormalTexture,map:whaleColorTexture}),whale_material_2=new THREE.MeshStandardMaterial({metalness:.1,roughness:.01,color:65535,flatShading:!0}),whale_material_3=new THREE.MeshStandardMaterial({wireframe:!1,metalness:1,roughness:.6,flatShading:!0,color:settings.color_material_whale_level_3,fog:!1,shininess:0,emissive:40}),groupDebugWhaleLevel3=gui.addFolder("WhaleMaterialLevel3");groupDebugWhaleLevel3.addColor(settings,"color_material_whale_level_3").onChange((function(){whale_mesh_level3.material.color.set(settings.color_material_whale_level_3)}));const textMaterial=new THREE.MeshStandardMaterial({color:15658734,fog:!1,roughness:1,transparent:!0}),textHoverMaterial=new THREE.MeshStandardMaterial({color:52428,fog:!1,roughness:1,transparent:!0}),waterGeometry=new THREE.PlaneBufferGeometry(5,3,24,24),waterGeometry_2=new THREE.PlaneBufferGeometry(15,15,32,32),waterMaterial=new THREE.ShaderMaterial({vertexShader:waterVertexShader,fragmentShader:waterFragmentShader,transparent:!0,uniforms:{uTime:{value:0},uBigWavesElevation:{value:.03},uBigWavesFrequency:{value:new THREE.Vector2(2.2,5.5)},uBigWaveSpeed:{value:.75},uSmallWavesElevation:{value:.038},uSmallWavesFrequency:{value:3.4},uSmallWavesSpeed:{value:.3},uSmallWavesIterations:{value:1},uDepthColor:{value:new THREE.Color(settings.depthColor)},uSurfaceColor:{value:new THREE.Color(settings.surfaceColor)},uColorOffset:{value:.08},uColorMultiplay:{value:5}}}),waterGroup=gui.addFolder("Water");waterGroup.add(settings,"water_position_x").min(-10).max(10).step(.1).name("Position Water X").onChange(()=>{water.position.x=settings.water_position_x}),waterGroup.add(settings,"water_position_y").min(-10).max(10).step(.1).name("Position Water Y").onChange(()=>{water.position.y=settings.water_position_y}),waterGroup.add(settings,"water_position_z").min(-10).max(10).step(.1).name("Position Water Z").onChange(()=>{water.position.z=settings.water_position_z}),waterGroup.add(waterMaterial.uniforms.uSmallWavesElevation,"value").min(0).max(1).step(.001).name("uSmallWavesElevation"),waterGroup.add(waterMaterial.uniforms.uSmallWavesFrequency,"value").min(0).max(30).step(.001).name("uSmallWavesFrequency"),waterGroup.add(waterMaterial.uniforms.uSmallWavesSpeed,"value").min(0).max(4).step(.001).name("uSmallWavesSpeed"),waterGroup.add(waterMaterial.uniforms.uSmallWavesIterations,"value").min(0).max(5).step(1).name("uSmallWavesIterations"),waterGroup.add(waterMaterial.uniforms.uColorOffset,"value").min(0).max(1).step(.001).name("uColorOffset"),waterGroup.add(waterMaterial.uniforms.uColorMultiplay,"value").min(0).max(10).step(.001).name("uColorMultiplay"),waterGroup.add(waterMaterial.uniforms.uBigWavesElevation,"value").min(0).max(1).step(.001).name("uBigWavesElevation"),waterGroup.add(waterMaterial.uniforms.uBigWavesFrequency.value,"x").min(0).max(10).step(.001).name("uBigWavesFrequencyX"),waterGroup.add(waterMaterial.uniforms.uBigWavesFrequency.value,"y").min(0).max(10).step(.001).name("uBigWavesFrequencyY"),waterGroup.add(waterMaterial.uniforms.uBigWaveSpeed,"value").min(0).max(4).step(.001).name("uBigWaveSpeed"),waterGroup.addColor(settings,"depthColor").onChange(()=>{waterMaterial.uniforms.uDepthColor.value.set(settings.depthColor)}),waterGroup.addColor(settings,"surfaceColor").onChange(()=>{waterMaterial.uniforms.uSurfaceColor.value.set(settings.surfaceColor)}),waterGroup.add(settings,"water_rotation_x").min(0).max(1).step(.001).name("Rotate Water X");const water=new THREE.Mesh(waterGeometry,waterMaterial);water.rotation.x=-Math.PI*settings.water_rotation_x,water.rotation.y=-Math.PI,water.position.x=settings.water_position_x,water.position.y=settings.water_position_y,water.position.z=settings.water_position_z,level_2_group.add(water),scene.add(level_2_group);const water_level_1=new THREE.Mesh(waterGeometry_2,waterMaterial);water_level_1.rotation.x=Math.PI*settings.water_rotation_x,water_level_1.rotation.y=-Math.PI,water_level_1.position.x=settings.water_level_1_position_x,water_level_1.position.y=settings.water_level_1_position_y,water_level_1.position.z=settings.water_level_1_position_z,level_1_group.add(water_level_1),scene.add(level_1_group),gltfLoader.load("/models/whale-best.glb",gltf=>{console.log("gltf",gltf),whale_model=gltf.scene,whale_model.traverse((function(object){object.isMesh&&(whale_mesh=object,whale_mesh.material=whale_material)})),whale_model.position.z=-4,level_2_group.add(whale_model);const edgies_whale_1=new THREE.EdgesGeometry(whale_mesh.geometry),lines_edgies_whale_1=new THREE.LineSegments(edgies_whale_1,new THREE.LineBasicMaterial({color:16777215}));level_2_group.add(lines_edgies_whale_1),whale_group_level3=new THREE.Group,whale_mesh_level3=new THREE.Mesh(whale_mesh.geometry,whale_material_3),whale_group_level3.add(whale_mesh_level3);const point_cursor_geometry_level3=new THREE.SphereBufferGeometry(.2,18,18),point_cursor_material_level3=waterMaterial,point_cursor_mesh_level3=new THREE.Mesh(point_cursor_geometry_level3,point_cursor_material_level3),pointCursorLight_level3=new THREE.PointLight("#0094db",1.5,2);pointCursorLight_level3.position.set(0,0,.2),pointCursorGroup_level3.add(pointCursorLight_level3),pointCursorGroup_level3.add(point_cursor_mesh_level3),pointCursorGroup_level3.position.y=1.5,whale_group_level3.add(pointCursorGroup_level3),level_3_group.position.set(0,-8,-1),level_3_group.add(whale_group_level3),scene.add(level_3_group);const h1=document.querySelector("h1");h1.className+="show ",animations=gltf.animations,mixer=new THREE.AnimationMixer(whale_mesh),mixer.clipAction(animations[1]).play(),whaleNormalTexture.flipY=!1,whaleColorTexture.flipY=!1,new TWEEN.Tween(whale_model.position).to({z:0},3500).easing(TWEEN.Easing.Sinusoidal.Out).start().onComplete(()=>{document.querySelector("h1").className+=" hide",mixer.clipAction(animations[1]).stop(),mixer.clipAction(animations[0]).play()}),new TWEEN.Tween(whale_model.rotation).delay(3e3).to({y:.8},1e3).easing(TWEEN.Easing.Sinusoidal.Out).start().onComplete(()=>{console.log("call me")})});const debugParticlesGroupe=gui.addFolder("Particles");debugParticlesGroupe.add(settings,"mode_high_rotation");const particleTexture=textureLoader.load("/textures/particles/3.png"),particlesGeometry=new THREE.BufferGeometry,count_1=120,positions=new Float32Array(360);for(let i=0;i<360;i++)positions[i]=i%3?i%2?2.25*Math.random():i%3!=1?12*(Math.random()-.5):2.25*Math.random():12*(Math.random()-.5);particlesGeometry.setAttribute("position",new THREE.BufferAttribute(positions,3));const particlesMaterial=new THREE.PointsMaterial;particlesMaterial.size=.05,particlesMaterial.sizeAttenuation=!0,particlesMaterial.transparent=!0,particlesMaterial.alphaMap=particleTexture,particlesMaterial.opacity=.1,particlesMaterial.fog=!1,particlesMaterial.alphaTest=.01,particlesMaterial.vertexColors=!0,particles=new THREE.Points(particlesGeometry,particlesMaterial),particles.position.y=-1,level_2_group.add(particles),console.log("particles",particles);const particleTexture_2=textureLoader.load("/textures/particles/102.png"),particlesGeometry_2=new THREE.BufferGeometry,count_2=120,positions_2=new Float32Array(360),scale_2=new Float32Array(360);for(let i=0;i<360;i++)positions_2[i]=i%3?i%2?2.25*Math.random():i%3!=1?12*(Math.random()-.5):2.25*Math.random():12*(Math.random()-.5),scale_2[i]=Math.random();particlesGeometry_2.setAttribute("position",new THREE.BufferAttribute(positions_2,3));const particlesMaterial_2=new THREE.PointsMaterial;particlesMaterial_2.size=.06,particlesMaterial_2.sizeAttenuation=!0,particlesMaterial_2.color=new THREE.Color(1,1,1),particlesMaterial_2.transparent=!0,particlesMaterial_2.opacity=.4,particlesMaterial_2.alphaMap=particleTexture_2,particlesMaterial_2.depthTest=!1,particles_2=new THREE.Points(particlesGeometry_2,particlesMaterial_2),particles_2.position.y=-1,level_2_group.add(particles_2);const fontLoader=new FontLoader;fontLoader.load("/fonts/intro.json",font=>{const materialPlaneHelterText=new THREE.MeshBasicMaterial({opacity:0,transparent:!0}),text_1_group=new THREE.Group,textGeometry=new TextGeometry("Доставка в \nНижнем Новгороде",{font:font,size:.12,height:.01,curveSegments:2,bevelEnabled:!0,bevelThickness:.001,bevelSize:1e-4,bevelOffset:0,bevelSegments:5}),text=new THREE.Mesh(textGeometry,textMaterial),text_1_plane_helper_mesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,.5,2),materialPlaneHelterText);text_1_plane_helper_mesh.position.x+=1,text_1_group.position.x=settings.text_position_x,text_1_group.position.y=settings.text_position_y,text_1_group.position.z=settings.text_position_z,text_1_group.rotation.y=Math.PI/6,text_1_group.add(text),text_1_group.name="delivery_page",text_1_group.add(text_1_plane_helper_mesh);const text_2_group=new THREE.Group,textGeometry_2=new TextGeometry("Сопутствующие\nтовары",{font:font,size:.12,height:.01,curveSegments:2,bevelEnabled:!0,bevelThickness:.001,bevelSize:1e-4,bevelOffset:0,bevelSegments:5}),text_2=new THREE.Mesh(textGeometry_2,textMaterial),text_2_plane_helper_mesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(1.2,.4,2),materialPlaneHelterText);text_2_plane_helper_mesh.position.x+=.6,text_2_group.position.x=settings.text_2_position_x,text_2_group.position.y=settings.text_2_position_y,text_2_group.position.z=settings.text_2_position_z,text_2_group.rotation.y=Math.PI/8,text_2_group.add(text_2),text_2_group.name="extra_goods_page",text_2_group.add(text_2_plane_helper_mesh);const text_3_group=new THREE.Group,textGeometry_3=new TextGeometry("Насосное\nоборудование",{font:font,size:.15,height:.01,curveSegments:2,bevelEnabled:!0,bevelThickness:.001,bevelSize:1e-4,bevelOffset:0,bevelSegments:5}),text_3=new THREE.Mesh(textGeometry_3,textMaterial),text_3_plane_helper_mesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(1.8,.5,2),materialPlaneHelterText);text_3_plane_helper_mesh.position.x+=.9,text_3_group.position.x=settings.text_3_position_x,text_3_group.position.y=settings.text_3_position_y,text_3_group.position.z=settings.text_3_position_z,text_3_group.rotation.y=-Math.PI/25,text_3_group.rotation.x=Math.PI/16,text_3_group.add(text_3),text_3_group.name="nasos_page",text_3_group.add(text_3_plane_helper_mesh);const text_4_group=new THREE.Group,textGeometry_4=new TextGeometry("Системы\nочистки воды",{font:font,size:.12,height:.01,curveSegments:2,bevelEnabled:!0,bevelThickness:.001,bevelSize:1e-4,bevelOffset:0,bevelSegments:5}),text_4=new THREE.Mesh(textGeometry_4,textMaterial),text_4_plane_helper_mesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(1.5,.5,2),materialPlaneHelterText);text_4_plane_helper_mesh.position.x+=.75,text_4_group.position.x=settings.text_4_position_x,text_4_group.position.y=settings.text_4_position_y,text_4_group.position.z=settings.text_4_position_z,text_4_group.rotation.y=Math.PI/14,text_4_group.add(text_4),text_4_group.name="sistem_ochistka",console.log(text_4_group),text_4_group.add(text_4_plane_helper_mesh);const text_5_group=new THREE.Group,textGeometry_5=new TextGeometry("Популярные\n бренды",{font:font,size:.08,height:.01,curveSegments:2,bevelEnabled:!0,bevelThickness:.001,bevelSize:1e-4,bevelOffset:0,bevelSegments:5}),text_5=new THREE.Mesh(textGeometry_5,textMaterial),text_5_plane_helper_mesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(1.5,.5,2),materialPlaneHelterText);text_5_plane_helper_mesh.position.x+=.75,text_5_group.position.x=settings.text_5_position_x,text_5_group.position.y=settings.text_5_position_y,text_5_group.position.z=settings.text_5_position_z,text_5_group.rotation.y=Math.PI/20,text_5_group.add(text_5),text_5_group.name="brands_page",text_5_group.add(text_5_plane_helper_mesh),text_objs_for_raycaster=[text_1_plane_helper_mesh,text_2_plane_helper_mesh,text_3_plane_helper_mesh,text_4_plane_helper_mesh,text_5_plane_helper_mesh],level_2_text_group=new THREE.Group,level_2_text_group.scale.x=.004,level_2_text_group.scale.y=.004,level_2_text_group.scale.z=.004,level_2_text_group.rotation.y=2*Math.PI,level_2_text_group.add(text_1_group),level_2_text_group.add(text_2_group),level_2_text_group.add(text_3_group),level_2_text_group.add(text_4_group),level_2_text_group.add(text_5_group),level_2_group.add(level_2_text_group),new TWEEN.Tween(level_2_text_group.scale).delay(2500).to({x:1,y:1,z:1},1e3).easing(TWEEN.Easing.Elastic.Out).start(),new TWEEN.Tween(level_2_text_group.rotation).delay(2500).to({y:0},1e3).easing(TWEEN.Easing.Sinusoidal.Out).start();const text1DebugFolder=gui.addFolder("Text 1");text1DebugFolder.add(settings,"text_position_x").min(-10).max(10).step(.01).name("x").onChange(()=>{text_1_group.position.x=settings.text_position_x}),text1DebugFolder.add(settings,"text_position_y").min(-10).max(10).step(.01).name("y").onChange(()=>{text_1_group.position.y=settings.text_position_y}),text1DebugFolder.add(settings,"text_position_z").min(-10).max(10).step(.01).name("z").onChange(()=>{text_1_group.position.z=settings.text_position_z});const text2DebugFolder=gui.addFolder("Text 2");text2DebugFolder.add(settings,"text_2_position_x").min(-10).max(10).step(.01).name("x").onChange(()=>{text_2_group.position.x=settings.text_2_position_x}),text2DebugFolder.add(settings,"text_2_position_y").min(-10).max(10).step(.01).name("y").onChange(()=>{text_2_group.position.y=settings.text_2_position_y}),text2DebugFolder.add(settings,"text_2_position_z").min(-10).max(10).step(.01).name("z").onChange(()=>{text_2_group.position.z=settings.text_2_position_z});const text3DebugFolder=gui.addFolder("Text 3");text3DebugFolder.add(settings,"text_3_position_x").min(-10).max(10).step(.01).name("x").onChange(()=>{text_3_group.position.x=settings.text_3_position_x}),text3DebugFolder.add(settings,"text_3_position_y").min(-10).max(10).step(.01).name("y").onChange(()=>{text_3_group.position.y=settings.text_3_position_y}),text3DebugFolder.add(settings,"text_3_position_z").min(-10).max(10).step(.01).name("z").onChange(()=>{text_3_group.position.z=settings.text_3_position_z});const text4DebugFolder=gui.addFolder("Text 4");text4DebugFolder.add(settings,"text_4_position_x").min(-10).max(10).step(.01).name("x").onChange(()=>{text_4_group.position.x=settings.text_4_position_x}),text4DebugFolder.add(settings,"text_4_position_y").min(-10).max(10).step(.01).name("y").onChange(()=>{text_4_group.position.y=settings.text_4_position_y}),text4DebugFolder.add(settings,"text_4_position_z").min(-10).max(10).step(.01).name("z").onChange(()=>{text_4_group.position.z=settings.text_4_position_z});const text5DebugFolder=gui.addFolder("Text 5");text5DebugFolder.add(settings,"text_5_position_x").min(-10).max(10).step(.01).name("x").onChange(()=>{text_5_group.position.x=settings.text_5_position_x}),text5DebugFolder.add(settings,"text_5_position_y").min(-10).max(10).step(.01).name("y").onChange(()=>{text_5_group.position.y=settings.text_5_position_y}),text5DebugFolder.add(settings,"text_5_position_z").min(-10).max(10).step(.01).name("z").onChange(()=>{text_5_group.position.z=settings.text_5_position_z})});const sizes={width:window.innerWidth,height:window.innerHeight};let windowHalfX=sizes.width/2,windowHalfY=sizes.height/2;window.addEventListener("resize",()=>{sizes.width=window.innerWidth,sizes.height=window.innerHeight,camera.aspect=sizes.width/sizes.height,camera.updateProjectionMatrix(),renderer.setSize(sizes.width,sizes.height),renderer.setPixelRatio(Math.min(window.devicePixelRatio,2))});const camera=new THREE.PerspectiveCamera(75,sizes.width/sizes.height,.1,100);camera.lookAt(0,0,0),camera.position.set(settings.camera_position_x,settings.camera_position_y,settings.camera_position_z),scene.add(camera);const renderer=new THREE.WebGLRenderer({canvas:canvas,antialias:!0,alpha:!0});renderer.setSize(sizes.width,sizes.height),renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),scene.fog=new THREE.Fog(2316922,.1,6.5);const debugLigths=gui.addFolder("Lights"),ambientLight=new THREE.AmbientLight("#b9d5ff",.75);debugLigths.add(ambientLight,"intensity").min(0).max(1).step(.001),scene.add(ambientLight);const moonLight=new THREE.DirectionalLight("#b9d5ff",.4);moonLight.position.set(2,-2,6),debugLigths.add(moonLight,"intensity").min(0).max(1).step(.001),debugLigths.add(moonLight.position,"x").min(-15).max(15).step(.001),debugLigths.add(moonLight.position,"y").min(-15).max(15).step(.001),debugLigths.add(moonLight.position,"z").min(-15).max(15).step(.001),scene.add(moonLight),pointCursorGroup=new THREE.Group,pointCursorGroup_level3=new THREE.Group;const point_cursor_geometry=new THREE.SphereBufferGeometry(.05,24,24),point_cursor_material=new THREE.MeshStandardMaterial({color:43690,fog:!1,flatShading:!0,roughness:1}),point_cursor_mesh=new THREE.Mesh(point_cursor_geometry,point_cursor_material),pointCursorLight=new THREE.PointLight("#0094db",1.5,2);pointCursorLight.position.set(0,0,.2),pointCursorGroup.add(pointCursorLight),pointCursorGroup.add(point_cursor_mesh),pointCursorGroup.position.z=5,level_2_group.add(pointCursorGroup),level_1_group.position.set(0,10,0);const clock=new THREE.Clock,tick=()=>{const elapsedTime=clock.getElapsedTime(),time=Date.now();waterMaterial.uniforms.uTime.value=elapsedTime,camera.lookAt(0,0,0),camera.position.x=settings.camera_position_x+Math.sin(elapsedTime)/10,camera.position.y=settings.camera_position_y+Math.cos(elapsedTime)/12,camera.position.x=.05*(.01*mouseX-.01*settings.camera_position_x),camera.position.y=.05*(.005*-mouseY-.005*settings.camera_position_y),mixer&&(mixer.update(.001*(time-prevTime)),prevTime=time,whale_group_level3.rotation.y+=.001),particles.rotation.y+=.002,particles_2.rotation.y+=.007,raycaster.setFromCamera(mouse_ray,camera);let intersects=raycaster.intersectObjects(text_objs_for_raycaster);for(const planes_helper_text of text_objs_for_raycaster)active_text_group!==planes_helper_text.parent&&(planes_helper_text.parent.children[0].material=textMaterial);if(intersects.length>0)for(const intersect_group of intersects)intersect_group.object.parent.children[0].material=textHoverMaterial,settings.camera_look_at_center&&(active_text_group!=intersect_group.object.parent&&(active_text_group=intersect_group.object.parent,tween_cursor_animation.stop(),tween_cursor_animation=new TWEEN.Tween(pointCursorGroup.position).to({x:intersect_group.object.parent.position.x-.1,y:intersect_group.object.parent.position.y+.05,z:intersect_group.object.parent.position.z},1e3).easing(TWEEN.Easing.Bounce.Out).start()),document.addEventListener("click",openLevel2Page));else document.removeEventListener("click",openLevel2Page);point_cursor_mesh.rotation.y+=.01,pointCursorGroup_level3.position.y=Math.sin(elapsedTime),pointCursorGroup_level3.position.x=Math.cos(elapsedTime),pointCursorGroup_level3.position.z=Math.sin(.5*elapsedTime),TWEEN.update(),renderer.render(scene,camera),window.requestAnimationFrame(tick)};function onDocumentMouseMove(event){mouseX=event.clientX-windowHalfX,mouseY=event.clientY-windowHalfY,mouse_ray.x=event.clientX/sizes.width*2-1,mouse_ray.y=-(event.clientY/sizes.height*2-1)}function onDocumentScroll(event){console.log(event)}function goToLevel1(event){if(settings.level_animation_start)return!1;settings.level_animation_start=!0,canvas.classList.remove("level3"),canvas.classList.remove("level2"),canvas.classList.add("level1");const all_btns=document.querySelectorAll("#bottom_buttons_whale .btn-bot");for(const btn of all_btns)btn.classList.remove("active");event.target.classList.add("active"),new TWEEN.Tween(level_2_group.position).to({y:-5},1500).easing(TWEEN.Easing.Sinusoidal.Out).start(),new TWEEN.Tween(level_1_group.position).to({y:0},1500).easing(TWEEN.Easing.Sinusoidal.Out).start().onComplete(()=>{whale_mesh.material=whale_material_2}),new TWEEN.Tween(whale_model.position).to({y:4,z:2},3500).easing(TWEEN.Easing.Sinusoidal.Out).start(),new TWEEN.Tween(whale_model.rotation).to({y:.45*Math.PI},3500).easing(TWEEN.Easing.Sinusoidal.Out).start()}function goToLevel3(event){if(settings.level_animation_start)return!1;settings.level_animation_start=!0,canvas.classList.remove("level1"),canvas.classList.remove("level2"),canvas.classList.add("level3");const all_btns=document.querySelectorAll("#bottom_buttons_whale .btn-bot");for(const btn of all_btns)btn.classList.remove("active");event.target.classList.add("active"),new TWEEN.Tween(level_2_group.position).to({y:10},1500).easing(TWEEN.Easing.Sinusoidal.Out).start(),new TWEEN.Tween(level_3_group.position).to({y:-1.5},1500).easing(TWEEN.Easing.Sinusoidal.Out).start().onComplete(()=>{document.querySelector(".listing_uslug_level_3").classList.add("open"),document.querySelector(".listing_uslug_level_3").addEventListener("mouseover",(function(){hoverOnUslugaLevel3()})),document.querySelector(".listing_uslug_level_3").addEventListener("mouseout",(function(){hoverOutUslugaLevel3()})),settings.level_animation_start=!1,settings.active_level=3})}function goToLevel2(event){if(settings.level_animation_start)return!1;settings.level_animation_start=!0,canvas.classList.remove("level1"),canvas.classList.remove("level3"),canvas.classList.add("level2");const all_btns=document.querySelectorAll("#bottom_buttons_whale .btn-bot");for(const btn of all_btns)btn.classList.remove("active");event.target.classList.add("active"),document.querySelector(".listing_uslug_level_3").classList.remove("open"),new TWEEN.Tween(level_3_group.position).to({y:-8},1500).easing(TWEEN.Easing.Sinusoidal.Out).start(),new TWEEN.Tween(level_2_group.position).to({y:0},1500).easing(TWEEN.Easing.Sinusoidal.Out).start().onComplete(()=>{settings.active_level=2,settings.level_animation_start=!1})}function hoverOnUslugaLevel3(){cameraAnimation.stop(),cameraAnimation=new TWEEN.Tween(whale_group_level3.position).to({z:3,y:1},500).start(),cameraAnimation=new TWEEN.Tween(whale_group_level3.rotation).to({y:2},500).start()}function hoverOutUslugaLevel3(){cameraAnimation.stop(),cameraAnimation=new TWEEN.Tween(whale_group_level3.position).to({z:0,y:0},500).start(),cameraAnimation=new TWEEN.Tween(whale_group_level3.rotation).to({y:0},500).start()}function openLevel2Page(){document.removeEventListener("click",openLevel2Page);const page_to_show=document.querySelector("#"+active_text_group.name);document.querySelector(".pages_level_2").classList.add("open"),document.querySelector("#bottom_buttons_whale").classList.add("close"),page_to_show.classList.add("open"),settings.camera_look_at_center=!1,new TWEEN.Tween(level_2_group.position).to({x:-active_text_group.position.x,y:-active_text_group.position.y,z:4-active_text_group.position.z},500).start()}function closeLevel2Page(){console.log("closeLevel2Page"),document.querySelector(".pages_level_2").classList.remove("open"),document.querySelector("#bottom_buttons_whale").classList.remove("close");const elements=document.querySelectorAll(".pages_level_2 .rf_item");for(const el of elements)el.classList.remove("open");settings.camera_look_at_center=!0,new TWEEN.Tween(level_2_group.position).to({x:0,y:0,z:0},500).start()}tick(),document.querySelector("#button_to_level_1").addEventListener("click",goToLevel1),document.querySelector("#button_to_level_3").addEventListener("click",goToLevel3),document.querySelector("#button_to_level_2").addEventListener("click",goToLevel2);const close_btns=document.querySelectorAll(".pages_level_2 .rf_item .rf_close_item");for(let cl_btn of close_btns)cl_btn.addEventListener("click",closeLevel2Page);